---
title: "ensembl_cardiac_diseases_panel_20200715"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
suppressMessages(library(knitr))
suppressMessages(library(data.table))
suppressMessages(library(tidyverse))

outlier <- function (x) {
  IQR <- quantile(x)[[4]] - quantile(x)[[2]]
  low <- quantile(x)[[2]] - 1.5*IQR
  high <- quantile(x)[[4]] + 1.5*IQR
  out_val <- x[x < low | x > high]
  return(out_val)
}
```

```{r sample info, echo=FALSE}
pheno <- fread('input/plink_data/pheno.txt')
pheno %>% na.omit %>% ggplot(aes(factor(Y1))) + geom_bar(fill=c('#27384A','#48C095'),width=0.5) +
  geom_text(stat='count', aes(label=..count..), vjust=-1) + 
  theme_classic() + 
  ylim(c(0,900)) + 
  ylab('Number of individuals') +
  xlab('Covid severity') +
  scale_x_discrete(labels=c('Severe + mild','Control')) + 
  ggtitle(paste('Distribution of covid severity in cohort of',pheno %>% 
                  na.omit() %>% nrow(), 'individuals',sep = ' ')) +
  theme(plot.title = element_text(hjust = 0.5))
```



```{r af plot, echo=FALSE}
cardiac_fish <- fread('output/cardiac_panel.assoc.fisher') %>% na.omit()
cardiac_sig <- cardiac_fish %>%
  filter(P < 0.005)

vep_pos <- cardiac_sig %>% select(CHR,BP)
vep_pos$POS <- paste('chr',vep_pos$CHR,sep='')
vep_pos$POS <- paste(vep_pos$POS, vep_pos$BP,sep=':')
write.table(vep_pos$POS,'input/cardiac_pos.tsv',quote = F,
             col.names = F,
             row.names = F,
             sep='\t')

cardiac_sig %>%
  ggplot(aes(x=F_U,y=F_A)) + geom_point(col='#48C095') +
  geom_smooth(method = 'lm', col = '#27384A', formula = 'y~x',se=F) +
  ylab('Frequency of allele in cases') +
  xlab('Frequency of allele in controls') +
  ggtitle('Frequency of alleles in cases and controls', subtitle = 'Fisher exact test P value < 0.005') + 
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5),plot.subtitle = element_text(hjust=0.5))
  

```

```{r OR plot, echo=FALSE}
cardiac_fish %>% 
  filter(P < 0.005) %>%
  ggplot(aes(x=OR,y=1)) + 
  geom_violin(fill='#48C095', col='#27384A') +
  geom_boxplot(width=0.1) +
  ylab('') +
  xlab('Odds ratio') +
  ggtitle('Estimated odds ratio of minor allele', subtitle = 'Fisher exact test P value < 0.005') + 
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5),plot.subtitle = element_text(hjust=0.5)) +
  theme(axis.text.y = element_blank())
  
```


```{r OR outliers, echo=FALSE}
or_out <- cardiac_fish %>% filter(P < 0.005) %>% filter(OR %in% outlier(cardiac_fish$OR))

```

```{r, echo =FALSE}
#vep <- read.csv('input/cardiac_panel.vep',skip = 93,header=T,sep='\t')
#glimpse(vep)
```


```{r vep, echo =FALSE}
#or_out_vep <- or_out %>% left_join(vep,by = c('SNP' = 'X.Uploaded_variation'))

```

